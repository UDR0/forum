<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Forum de voyage - Partagez vos expériences et conseils sur les destinations de la France.">
    <meta name="keywords" content="forum, voyage, destinations, partage, communauté">
    <meta name="author" content="Matias, Sara, Samuel, William">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Pacifico&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sen:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <title>MyTripy</title>
    <link rel="stylesheet" href="static/css/styles.css">
    <link rel="stylesheet" href="static/css/styles-desktop.css" media="screen and (min-width: 1024px)">
</head>

<body>

    <!-- Header -->
    <header>
        <!-- Logo -->
        <a href="/mytripy-non" class="logo">
            <img class="image_logo" src="static/img/logo/logo-mytripy-2.png" alt="MyTripy Logo">
            <img class="mytripy" src="static/img/logo/mytripy.png" alt="MyTripy">
            <!-- <span class="text_logo">My<span>Trip</span>y</span> -->
        </a>

        <!-- Menu Burger -->
        <button class="burger-menu" id="burger">
            <img src="static/img/menu-black.png" alt="menu">
        </button>

        <!-- Navigation -->
        <ul class="meta-ul">
            <li class="meta-navigation">
                <a class="meta-a" href="/mytripy-non">MyTripy</a>
            </li>

            <li class="meta-navigation">
                <a class="meta-a" href="/destinations">Destinations</a>
            </li>

            <li class="meta-navigation">
                <a class="meta-a" href="/contact">Contactez-nous</a>
            </li>

            <li class="meta-navigation-btn-connexion">
                <a class="btn" href="/profil">Mon Compte</a>
            </li>
        </ul>

    </header>

    <!-- Contenu principal -->
    <section>
        <div id="message-container" class="allPosts">
            {{range .Messages}}
            <div class="post">
                <div class="infoPost">
                    <img src="{{.ImgUser}}" class="photoProfil" alt="Photo de profil">
                    <div class="txtInfoPost">
                        <h3>{{.Sender}}</h3>
                        <h4>{{.TimeElapsed}}</h4>
                    </div>
                </div>
                <div class="message">
                    <p>{{.Message}}</p>
                </div>
                <img src="../static/img/coeur.png" class="msg-like" id="msg-like">
            </div>
            {{end}}
        </div>
    </section>
        <div class="conainerWritePost">
            <textarea placeholder="Tapez votre Post..." class="inputPost" oninput="adjustHeight(this)"></textarea>
            <img src="static/img/envoyer.png" alt="Icone d'envoi" class="iconSend"  alt="like button">
        </div>
   

    <script>
        function fetchMessages() {
            fetch('/fetch-messages?chatname={{.ChatName}}')
                .then(response => response.json())
                .then(messages => {
                    const messageList = document.getElementById("message-list");
                    messageList.innerHTML = ""; // Clear current messages

                    if (!Array.isArray(messages) || messages.length === 0) {
                        const noMessagesMessage = document.createElement("p");
                        noMessagesMessage.textContent = "Aucun message dans ce chat pour le moment. Soyez le premier à en envoyer un !";
                        messageList.appendChild(noMessagesMessage);
                        return;
                    }

                    messages.forEach(msg => {
                        const listItem = document.createElement("li");
                        listItem.setAttribute("data-message-id", msg.MessageID);
                        listItem.innerHTML = `
                            <strong>${msg.Sender}:</strong> ${msg.Message}
                            <span style="float: right;">${msg.TimeElapsed}</span>
                            <img src="/static/img/coeur${msg.Liked ? "-filled" : ""}.png" class="iconLikePost" alt="Like Icon" onclick="toggleLike(${msg.MessageID})" alt="like button">
                        `;
                        messageList.appendChild(listItem);
                    });
                })
                .catch(error => console.error("Erreur lors de la récupération des messages :", error));
        }


        // Refresh messages every 4 seconds
        const chatName = "my-chat"; // Replace with the current chat name
        setInterval(() => {
            fetchMessages(chatName);
        }, 4000);

    </script>
    <script src="static/script.js"></script>
</body>

</html>