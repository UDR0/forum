<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Welcome</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <div class="container">
        <h2>Welcome!</h2>
        <p>You are successfully logged in.</p>

        <h2>Available Chats</h2>
        <ul id="chat-list">
            {{range .Chats}}
            <li>
                <!-- Form to select a chat using POST -->
                <form action="/select-chat" method="POST" style="display: inline;">
                    <input type="hidden" name="chatname" value="{{.Name}}">
                    <button type="submit">{{.Name}} ({{.Creator}})</button>
                </form>
            </li>
            {{else}}
            <p>No chats available. Create one below!</p>
            {{end}}
        </ul>

        <h2>Create a New Chat</h2>
        <form id="createChatForm" action="/create-chat" method="post">
            <input type="text" name="chatname" placeholder="Enter chat name" required>
            <button type="submit">Create Chat</button>
        </form>
    </div>

    <script>
        function fetchChats() {
            fetch("/fetch-chats")
                .then(response => response.json())
                .then(chats => {
                    if (!Array.isArray(chats)) {
                        console.error("Error: chats is not an array", chats);
                        return;
                    }

                    const chatList = document.getElementById("chat-list");
                    chatList.innerHTML = ""; // Clear current chats

                    chats.forEach(chat => {
                        const listItem = document.createElement("li");
                        listItem.innerHTML = `<form action="/select-chat" method="POST" style="display: inline;">
                    <input type="hidden" name="chatname" value="${chat.Name}">
                    <button type="submit">${chat.Name} (${chat.Creator})</button>
                </form>`;
                        chatList.appendChild(listItem);
                    });
                })

                
                .catch(error => console.error("Error fetching chats:", error));
        }

    </script>


</body>

</html>