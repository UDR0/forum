<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Welcome</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <div class="container">
        
        <h2>Chats for {{.Region}}</h2>
        <ul id="chat-list">
            {{range .Chats}}
            <li>
                <form action="/select-chat" method="POST" style="display: inline;">
                    <input type="hidden" name="chatname" value="{{.Name}}">
                    <button type="submit">{{.Name}} ({{.Creator}})</button>
                </form>
            </li>
            {{else}}
            <p>No chats available in {{.Region}}. Create one below!</p>
            {{end}}
        </ul>

        <h2>Create a New Chat</h2>
        <form id="createChatForm" action="/create-chat" method="post">
            <input type="text" name="chatname" placeholder="Enter chat name" required>
            <input type="hidden" name="region" value="{{.Region}}">
            <button type="submit">Create Chat</button>
        </form>
    </div>

    <script>
        function fetchChats(region) {
    fetch(`/fetch-chats?region=${region}`)
        .then(response => response.json())
        .then(chats => {
            const chatList = document.getElementById("chat-list");
            chatList.innerHTML = ""; // Clear current chats

            if (!Array.isArray(chats) || chats.length === 0) {
                // Handle the case where no chats are available
                const noChatsMessage = document.createElement("p");
                noChatsMessage.textContent = `No chats available in ${region}. Create one below!`;
                chatList.appendChild(noChatsMessage);
                return;
            }

            // If chats are available, display them
            chats.forEach(chat => {
                const listItem = document.createElement("li");
                listItem.innerHTML = `<form action="/select-chat" method="POST" style="display: inline;">
                    <input type="hidden" name="chatname" value="${chat.Name}">
                    <button type="submit">${chat.Name} (${chat.Creator})</button>
                </form>`;
                chatList.appendChild(listItem);
            });
        })
        .catch(error => console.error("Error fetching chats:", error));
}



        // Dynamically fetch chats for the current region
        document.addEventListener("DOMContentLoaded", function () {
            fetchChats("{{.Region}}"); // Pass the region dynamically from Go template
        });
    </script>

</body>

</html>